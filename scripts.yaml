# ============================================================================
# BEREINIGTE SCRIPTS.YAML
# Duplikate entfernt - nur die aktive Version behalten
# ============================================================================

notify_all:
  alias: Notify All Devices
  mode: parallel
  max: 10
  fields:
    message:
      description: Message to send
      required: true
    title:
      description: Notification title
      required: false
  sequence:
    - action: notify.alexa_media_wohnzimmer
      data:
        title: "{{ title | default('Home Assistant') }}"
        message: "{{ message }}"
      continue_on_error: true

# All cover scripts moved to blind_agent.yaml

# ============================================================================
# SAFE BLIND CONTROL - Prevents opening twice in a row
# ============================================================================

# ============================================================================
# BLIND AGENT - SUBAGENT CONTROL
# ============================================================================

# blind_agent_control moved to blind_agent.yaml

# ============================================================================
# HEATING SCRIPTS
# ============================================================================

# Heating scripts moved to climate_agent.yaml

# ============================================================================
# NEW UTILITY SCRIPTS
# ============================================================================

goodnight:
  alias: "Gute Nacht Routine"
  description: "Turn off all lights, close blinds, set heating to night mode"
  mode: single
  sequence:
    # Turn off all lights
    - action: script.all_lights_off
    # Close all blinds
    - action: script.all_covers_close
    # Set heating to night temperature
    - action: climate.set_temperature
      target:
        entity_id:
          - climate.badezimmer_thermostat_bad
          - climate.wohnzimmer_thermostat_computer
      data:
        temperature: "{{ states('input_number.heizung_solltemperatur_nacht') | float(17) }}"
    # Activate sleep mode
    - action: input_boolean.turn_on
      target:
        entity_id: input_boolean.sleep_mode
    # Notify
    - action: notify.mobile_app_redmi_note_12_pro_5g
      data:
        title: "Gute Nacht ðŸŒ™"
        message: "Alle Lichter aus, RolllÃ¤den zu, Heizung auf Nachtmodus."
      continue_on_error: true

leaving_home:
  alias: "Haus Verlassen"
  description: "Activate away mode, close blinds, set ECO heating, turn off everything"
  mode: single
  sequence:
    # Turn off all lights
    - action: script.all_lights_off
    # Close all blinds
    - action: script.all_covers_close
    # Set heating to ECO
    - action: climate.set_temperature
      target:
        entity_id:
          - climate.badezimmer_thermostat_bad
          - climate.wohnzimmer_thermostat_computer
      data:
        temperature: "{{ states('input_number.heizung_solltemperatur_eco') | float(18) }}"
    # Turn off fans
    - action: fan.turn_off
      target:
        entity_id:
          - fan.wohnzimmer_wohnzimmer_deckenventilator_u_licht
          - fan.schlafzimmer_schlafzimmer_deckenventilator_u_licht
      continue_on_error: true
    # Activate away mode
    - action: input_boolean.turn_on
      target:
        entity_id: input_boolean.away_mode
    # Deactivate sleep mode
    - action: input_boolean.turn_off
      target:
        entity_id: input_boolean.sleep_mode

movie_mode:
  alias: "Filmabend Modus"
  description: "Dim lights for movie watching, close blinds"
  mode: single
  sequence:
    # Close living room blind
    # Close living room blind
    - action: cover.close_cover
      target:
        entity_id: cover.wohnzimmer_wohnzimmer_rollladen_vorhang
    # Dim buffet light to ambient
    - action: light.turn_on
      target:
        entity_id: light.wohnzimmer_wohnzimmer_buffet_lichtstreifen
      data:
        brightness_pct: 15
        color_temp_kelvin: 2200
    # Turn off ceiling light
    - action: light.turn_off
      target:
        entity_id: light.wohnzimmer_wohnzimmer_deckenventilator_u_licht
    # Turn off kitchen lights
    - action: light.turn_off
      target:
        entity_id:
          - light.kuche_kueche_deckenlicht_1
          - light.kuche_kueche_deckenlicht_2
          - light.kuche_kueche_lichtstreifen
    # Activate movie mode flag
    - action: input_boolean.turn_on
      target:
        entity_id: input_boolean.movie_mode

coming_home:
  alias: "Heimkommen"
  description: "Deactivate away mode, warm up house, turn on welcome lights"
  mode: single
  sequence:
    # Deactivate away mode
    - action: input_boolean.turn_off
      target:
        entity_id: input_boolean.away_mode
    # Set heating to comfort
    - action: climate.set_temperature
      target:
        entity_id:
          - climate.badezimmer_thermostat_bad
          - climate.wohnzimmer_thermostat_computer
      data:
        temperature: "{{ states('input_number.heizung_solltemperatur_komfort') | float(23) }}"
    # Open blinds if daytime
    - condition: state
      entity_id: sun.sun
      state: "above_horizon"
    - action: script.all_covers_open
# ============================================================================
# TIMED BLIND CONTROL
# ============================================================================

# Timed travel scripts moved to blind_agent.yaml
