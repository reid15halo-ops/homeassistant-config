# ============================================================================
# REID'S HOME ASSISTANT SCRIPTS
# ============================================================================

fire_flicker_effect:
  alias: Fireplace Flicker Effect
  description: Smooth realistic fire effect with imperceptible transitions
  sequence:
    - repeat:
        while:
          - condition: state
            entity_id: script.fire_flicker_effect
            state: "on"
        sequence:
          # Segment 1: Starker Aufloderer
          - service: light.turn_on
            target:
              entity_id:
                - light.buffet_licht
                - light.computer_licht_2
            data:
              hs_color: [35, 100]
              brightness_pct: >
                {% set current = state_attr('light.buffet_licht', 'brightness') | default(128) | int * 100 // 255 %}
                {% set change = range(10, 20) | random %}
                {{ max(10, min(100, current + change)) }}
              transition: 0
          - delay:
              milliseconds: "{{ range(20, 35) | random }}"

          # Segment 2: Schnelles Flackern
          - service: light.turn_on
            target:
              entity_id:
                - light.buffet_licht
                - light.computer_licht_2
            data:
              hs_color: [35, 100]
              brightness_pct: >
                {% set current = state_attr('light.buffet_licht', 'brightness') | default(128) | int * 100 // 255 %}
                {% set change = range(-15, 15) | random %}
                {{ max(10, min(100, current + change)) }}
              transition: 0
          - delay:
              milliseconds: "{{ range(25, 40) | random }}"

          # Segment 3: Abschwächung
          - service: light.turn_on
            target:
              entity_id:
                - light.buffet_licht
                - light.computer_licht_2
            data:
              hs_color: [35, 100]
              brightness_pct: >
                {% set current = state_attr('light.buffet_licht', 'brightness') | default(128) | int * 100 // 255 %}
                {% set change = range(-12, -5) | random %}
                {{ max(10, min(100, current + change)) }}
              transition: 0
          - delay:
              milliseconds: "{{ range(30, 45) | random }}"

          # Segment 4: Glut-Phase
          - service: light.turn_on
            target:
              entity_id:
                - light.buffet_licht
                - light.computer_licht_2
            data:
              hs_color: [35, 100]
              brightness_pct: >
                {% set current = state_attr('light.buffet_licht', 'brightness') | default(128) | int * 100 // 255 %}
                {% set change = range(-5, 5) | random %}
                {{ max(10, min(40, current + change)) }}
              transition: 0
          - delay:
              milliseconds: "{{ range(35, 50) | random }}"

          # Segment 5: Explosive Spitze
          - service: light.turn_on
            target:
              entity_id:
                - light.buffet_licht
                - light.computer_licht_2
            data:
              hs_color: [35, 100]
              brightness_pct: >
                {% set current = state_attr('light.buffet_licht', 'brightness') | default(128) | int * 100 // 255 %}
                {% set change = range(15, 30) | random %}
                {{ max(10, min(100, current + change)) }}
              transition: 0
          - delay:
              milliseconds: "{{ range(20, 30) | random }}"

          # Segment 6: Wilde Oszillation
          - service: light.turn_on
            target:
              entity_id:
                - light.buffet_licht
                - light.computer_licht_2
            data:
              hs_color: [35, 100]
              brightness_pct: >
                {% set current = state_attr('light.buffet_licht', 'brightness') | default(128) | int * 100 // 255 %}
                {% set change = range(-20, 20) | random %}
                {{ max(10, min(100, current + change)) }}
              transition: 0
          - delay:
              milliseconds: "{{ range(25, 40) | random }}"

          # Segment 7: Sanftes Pulsieren
          - service: light.turn_on
            target:
              entity_id:
                - light.buffet_licht
                - light.computer_licht_2
            data:
              hs_color: [35, 100]
              brightness_pct: >
                {% set current = state_attr('light.buffet_licht', 'brightness') | default(128) | int * 100 // 255 %}
                {% set change = range(-8, 8) | random %}
                {{ max(10, min(100, current + change)) }}
              transition: 0
          - delay:
              milliseconds: "{{ range(30, 45) | random }}"

          # Segment 8: Rapides Absinken
          - service: light.turn_on
            target:
              entity_id:
                - light.buffet_licht
                - light.computer_licht_2
            data:
              hs_color: [35, 100]
              brightness_pct: >
                {% set current = state_attr('light.buffet_licht', 'brightness') | default(128) | int * 100 // 255 %}
                {% set change = range(-18, -8) | random %}
                {{ max(10, min(100, current + change)) }}
              transition: 0
          - delay:
              milliseconds: "{{ range(30, 40) | random }}"

          # Segment 9: Mittelstarkes Flackern
          - service: light.turn_on
            target:
              entity_id:
                - light.buffet_licht
                - light.computer_licht_2
            data:
              hs_color: [35, 100]
              brightness_pct: >
                {% set current = state_attr('light.buffet_licht', 'brightness') | default(128) | int * 100 // 255 %}
                {% set change = range(-10, 10) | random %}
                {{ max(30, min(80, current + change)) }}
              transition: 0
          - delay:
              milliseconds: "{{ range(30, 45) | random }}"

          # Segment 10: Überraschungs-Burst
          - service: light.turn_on
            target:
              entity_id:
                - light.buffet_licht
                - light.computer_licht_2
            data:
              hs_color: [35, 100]
              brightness_pct: >
                {% set current = state_attr('light.buffet_licht', 'brightness') | default(128) | int * 100 // 255 %}
                {% set change = range(20, 40) | random %}
                {{ max(10, min(100, current + change)) }}
              transition: 0
          - delay:
              milliseconds: "{{ range(20, 35) | random }}"
  mode: restart

ambient_velvet_rainbow:
  alias: "Ambient - Velvet Rainbow"
  description: "Smooth rainbow color cycling"
  sequence:
    - repeat:
        count: 7
        sequence:
          - service: light.turn_on
            target:
              entity_id: light.buffet_licht
            data:
              hs_color:
                - "{{ range(0, 360) | random }}"
                - 100
              brightness_pct: 60
              transition: 2
          - delay:
              seconds: 3
  mode: single

cover_fahre_zeitbasiert:
  alias: "Cover - Fahre Zeitbasiert"
  description: "Time-based cover control"
  fields:
    cover_entity:
      description: "Cover entity to control"
      example: "cover.rollladen_computer_vorhang"
    position:
      description: "Target position (0-100)"
      example: "50"
  sequence:
    - service: cover.set_cover_position
      target:
        entity_id: "{{ cover_entity }}"
      data:
        position: "{{ position }}"
  mode: single

ventilator_wintermodus_low:
  alias: "Ventilator - Wintermodus Low"
  description: "Set ceiling fan to low speed for winter mode"
  sequence:
    - service: fan.set_percentage
      target:
        entity_id: fan.dc_fan_lamp
      data:
        percentage: 25
  mode: single

# ============================================================================
# ALEXA VOICE COMMAND SCRIPTS
# ============================================================================

guten_morgen:
  alias: "Guten Morgen"
  description: "Morning routine triggered by voice"
  sequence:
    - service: light.turn_on
      target:
        entity_id:
          - light.kuche_brine_1
          - light.kuche_birne_2_2
      data:
        brightness_pct: 80
        color_temp_kelvin: 3000
    - service: cover.open_cover
      target:
        entity_id: all
  mode: single

gute_nacht:
  alias: "Gute Nacht"
  description: "Night routine triggered by voice"
  sequence:
    - service: light.turn_off
      target:
        entity_id: all
    - service: cover.close_cover
      target:
        entity_id: all
    - service: climate.set_temperature
      target:
        entity_id:
          - climate.thermostat_bad
          - climate.thermostat_computer
      data:
        temperature: 17
  mode: single

ich_gehe:
  alias: "Ich gehe"
  description: "Leaving home routine"
  sequence:
    - service: light.turn_off
      target:
        entity_id: all
    - service: climate.set_temperature
      target:
        entity_id:
          - climate.thermostat_bad
          - climate.thermostat_computer
      data:
        temperature: 18
  mode: single

ich_bin_zuruck:
  alias: "Ich bin zurück"
  description: "Arriving home routine"
  sequence:
    - service: light.turn_on
      target:
        entity_id:
          - light.computer_licht_2
          - light.buffet_licht
      data:
        brightness_pct: 80
        color_temp_kelvin: 2700
    - service: climate.set_temperature
      target:
        entity_id:
          - climate.thermostat_bad
          - climate.thermostat_computer
      data:
        temperature: 23
  mode: single

filmzeit:
  alias: "Filmzeit"
  description: "Movie mode script"
  sequence:
    - service: input_boolean.turn_on
      target:
        entity_id: input_boolean.movie_mode
  mode: single

party:
  alias: "Party"
  description: "Party mode script"
  sequence:
    - service: input_boolean.turn_on
      target:
        entity_id: input_boolean.party_mode
    - service: light.turn_on
      target:
        entity_id:
          - light.buffet_licht
          - light.computer_licht_2
      data:
        brightness_pct: 100
        hs_color:
          - "{{ range(0, 360) | random }}"
          - 100
  mode: single
