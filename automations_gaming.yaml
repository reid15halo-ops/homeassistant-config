# ============================================================================
# REID'S GAMING AUTOMATIONS
# For optimal gaming experience - COZY CHIMNEY EDITION
# ============================================================================

# ============================================================================
# GAMING MODE - Auto-detect when gaming
# ============================================================================

- id: "gaming_mode_activate"
  alias: "Gaming - Modus aktivieren"
  description: "Activate gaming mode when sitting at computer for 5 minutes"
  trigger:
    - platform: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_1
      to: "on"
      for:
        minutes: 5
  condition:
    - condition: time
      after: "08:00"
      before: "03:00"
  action:
    # Turn on gaming mode
    - service: input_boolean.turn_on
      target:
        entity_id: input_boolean.gaming_mode
    # Chimney Fire Effect (Cozy)
    - service: script.turn_on
      target:
        entity_id: script.ambient_feuerlicht_warm_flicker
    # Turn off kitchen lights (no glare)
    - service: light.turn_off
      target:
        entity_id:
          - light.kuche_birne_1
          - light.kuche_birne_2
  mode: single

- id: "gaming_mode_deactivate"
  alias: "Gaming - Modus deaktivieren"
  description: "Deactivate gaming mode when leaving computer area"
  trigger:
    - platform: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_1
      to: "off"
      for:
        minutes: 10
  condition:
    - condition: state
      entity_id: input_boolean.gaming_mode
      state: "on"
  action:
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.gaming_mode
    # Restore normal lighting
    - service: light.turn_on
      target:
        entity_id:
          - light.computer_licht
          - light.buffet_lichtstreifen
      data:
        brightness_pct: 60
        color_temp_kelvin: 2700
  mode: single

# ============================================================================
# ANTI-GLARE - Close shutters for daytime gaming
# ============================================================================

- id: "gaming_anti_glare"
  alias: "Gaming - Blendschutz bei Tag"
  description: "Close computer shutter when gaming during bright day"
  trigger:
    - platform: state
      entity_id: input_boolean.gaming_mode
      to: "on"
  condition:
    # Only during daytime
    - condition: sun
      after: sunrise
      before: sunset
    # And when it's bright outside
    - condition: numeric_state
      entity_id: sensor.presence_sensor_fp2_f9cf_light_sensor_light_level
      above: 100
  action:
    - service: cover.close_cover
      target:
        entity_id: cover.rollladen_computer_vorhang
  mode: single

- id: "gaming_restore_shutter"
  alias: "Gaming - Rollladen Ã¶ffnen nach Gaming"
  description: "Open shutter when gaming mode ends during day"
  trigger:
    - platform: state
      entity_id: input_boolean.gaming_mode
      to: "off"
  condition:
    - condition: sun
      after: sunrise
      before: sunset
  action:
    - delay:
        minutes: 2
    - service: cover.open_cover
      target:
        entity_id: cover.rollladen_computer_vorhang
  mode: single

# ============================================================================
# GAMING BREAK REMINDER
# ============================================================================

- id: "gaming_break_reminder_2h"
  alias: "Gaming - Pause Erinnerung (2 Stunden)"
  description: "Remind to take a break after 2 hours of gaming"
  trigger:
    - platform: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_1
      to: "on"
      for:
        hours: 2
  condition:
    - condition: state
      entity_id: input_boolean.gaming_mode
      state: "on"
  action:
    # Flash lights briefly
    - service: light.turn_on
      target:
        entity_id: light.buffet_lichtstreifen
      data:
        brightness_pct: 100
        rgb_color: [0, 255, 0] # Green flash
    - delay:
        seconds: 2
    # Restore Fire Effect
    - service: script.turn_on
      target:
        entity_id: script.ambient_feuerlicht_warm_flicker
    # Send notification
    - service: notify.mobile_app_redmi_note_12_pro_5g
      data:
        title: "ðŸŽ® Gaming Pause!"
        message: "Du zockst seit 2 Stunden. Zeit fÃ¼r eine kurze Pause!"
  mode: single

# ============================================================================
# SNACK BREAK - Don't change lights when getting snacks
# ============================================================================

- id: "gaming_snack_break"
  alias: "Gaming - Snack Pause (KÃ¼che)"
  description: "Keep gaming lights when briefly going to kitchen"
  trigger:
    - platform: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_3 # Kitchen
      to: "on"
  condition:
    - condition: state
      entity_id: input_boolean.gaming_mode
      state: "on"
  action:
    # Just turn on kitchen light, don't change anything else
    - service: light.turn_on
      target:
        entity_id: light.kuche_streifen
      data:
        brightness_pct: 50
        color_temp_kelvin: 2700
  mode: single

- id: "gaming_snack_return"
  alias: "Gaming - RÃ¼ckkehr von Snack Pause"
  description: "Turn off kitchen light when returning to gaming"
  trigger:
    - platform: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_1 # Computer
      to: "on"
  condition:
    - condition: state
      entity_id: input_boolean.gaming_mode
      state: "on"
    - condition: state
      entity_id: light.kuche_streifen
      state: "on"
  action:
    - delay:
        seconds: 30
    - service: light.turn_off
      target:
        entity_id:
          - light.kuche_streifen
          - light.kuche_birne_1
          - light.kuche_birne_2
  mode: single

# ============================================================================
# NIGHT GAMING - Eye comfort mode
# ============================================================================

- id: "gaming_night_mode"
  alias: "Gaming - Nachtmodus (Augenkomfort)"
  description: "Warmer lighting after 22:00 for eye comfort"
  trigger:
    - platform: time
      at: "22:00"
  condition:
    - condition: state
      entity_id: input_boolean.gaming_mode
      state: "on"
  action:
    # Ensure fire effect is active (it's already warm)
    - service: script.turn_on
      target:
        entity_id: script.ambient_feuerlicht_warm_flicker
    # Notification
    - service: notify.mobile_app_redmi_note_12_pro_5g
      data:
        title: "ðŸŒ™ Nacht-Gaming-Modus"
        message: "Lichter bleiben gemÃ¼tlich warm."
  mode: single

# ============================================================================
# AFK DETECTION
# ============================================================================

- id: "gaming_afk_detected"
  alias: "Gaming - AFK erkannt"
  description: "Detect when AFK during gaming"
  trigger:
    - platform: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_1
      to: "off"
      for:
        minutes: 15
  condition:
    - condition: state
      entity_id: input_boolean.gaming_mode
      state: "on"
  action:
    # Dim lights to save energy
    - service: light.turn_on
      target:
        entity_id: light.computer_licht
      data:
        brightness_pct: 5
    - service: light.turn_off
      target:
        entity_id: light.buffet_lichtstreifen
  mode: single

- id: "gaming_afk_return"
  alias: "Gaming - ZurÃ¼ck von AFK"
  description: "Restore lights when returning from AFK"
  trigger:
    - platform: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_1
      to: "on"
  condition:
    - condition: state
      entity_id: input_boolean.gaming_mode
      state: "on"
    - condition: numeric_state
      entity_id: light.computer_licht
      attribute: brightness
      below: 30
  action:
    # Restore Fire Effect
    - service: script.turn_on
      target:
        entity_id: script.ambient_feuerlicht_warm_flicker
  mode: single
