# ============================================================================
# AUTOMATIONS (Global Simplification)
# ============================================================================

# ----------------------------------------------------------------------------
# MORNING ROUTINES (Simplified)
# ----------------------------------------------------------------------------
- id: wakeup_heat_weekday
  alias: "Morgen - Heizung Werktag (04:30)"
  trigger:
    - platform: time
      at: "04:30:00"
  condition:
    - condition: time
      weekday: [mon, tue, wed, thu, fri]
  action:
    - action: climate.set_temperature
      target:
        entity_id:
          - climate.badezimmer_thermostat_bad
          - climate.wohnzimmer_thermostat_computer
      data:
        temperature: 23

- id: wakeup_light_dim_weekday
  alias: "Morgen - Licht Dimmen Werktag (05:00)"
  trigger:
    - platform: time
      at: "05:00:00"
  condition:
    - condition: time
      weekday: [mon, tue, wed, thu, fri]
  action:
    - action: light.turn_on
      target:
        entity_id: light.schlafzimmer_schlafzimmer_bett_lichtstreifen
      data:
        brightness_pct: 5
        color_temp_kelvin: 2700
        transition: 1800

- id: wakeup_light_bright_weekday
  alias: "Morgen - Licht Hell Werktag (05:30)"
  trigger:
    - platform: time
      at: "05:30:00"
  condition:
    - condition: time
      weekday: [mon, tue, wed, thu, fri]
  action:
    - action: light.turn_on
      target:
        entity_id: light.schlafzimmer_schlafzimmer_bett_lichtstreifen
      data:
        brightness_pct: 80

- id: morning_wakeup_weekend
  alias: "Morgen - Aufwachen Wochenende (10:00)"
  trigger:
    - platform: time
      at: "09:30:00"
  condition:
    - condition: time
      weekday: [sat, sun]
  action:
    - action: light.turn_on
      target:
        entity_id: light.schlafzimmer_schlafzimmer_bett_lichtstreifen
      data:
        brightness_pct: 5
        color_temp_kelvin: 2700
        transition: 1800

# ----------------------------------------------------------------------------
# ROBOROCK
# ----------------------------------------------------------------------------
- id: roborock_clean_workday
  alias: "Roborock - Reinigung an Werktagen (12:00)"
  trigger:
    - platform: time
      at: "12:00:00"
  condition:
    - condition: time
      weekday: [mon, tue, wed, thu, fri]
    - condition: state
      entity_id: person.jonas_glawion
      state: not_home
  action:
    - action: vacuum.start
      target:
        entity_id: vacuum.wohnzimmer_roborock_q7_max

- id: roborock_stop_on_arrival
  alias: "Roborock - Stopp bei Heimkehr"
  trigger:
    - platform: state
      entity_id: person.jonas_glawion
      to: home
  condition:
    - condition: state
      entity_id: binary_sensor.wohnzimmer_roborock_q7_max_reinigen
      state: "on"
  action:
    - action: vacuum.return_to_base
      target:
        entity_id: vacuum.wohnzimmer_roborock_q7_max

# ----------------------------------------------------------------------------
# HOME / AWAY
# ----------------------------------------------------------------------------
- id: welcome_home_light
  alias: "Willkommen - Licht an bei Heimkehr"
  trigger:
    - platform: state
      entity_id: person.jonas_glawion
      to: home
  condition:
    - condition: sun
      after: sunset
      before: sunrise
  action:
    - action: light.turn_on
      target:
        entity_id: light.wohnzimmer_wohnzimmer_buffet_lichtstreifen
      data:
        brightness_pct: 80
        color_temp_kelvin: 2700

- id: welcome_home_heat
  alias: "Willkommen - Heizung an bei Heimkehr (Winter)"
  trigger:
    - platform: state
      entity_id: person.jonas_glawion
      to: home
  condition:
    - condition: template
      value_template: "{{ now().month in [11, 12, 1, 2] }}"
  action:
    - action: climate.set_temperature
      target:
        entity_id:
          - climate.badezimmer_thermostat_bad
          - climate.wohnzimmer_thermostat_computer
      data:
        temperature: 23

- id: away_mode_activate
  alias: "Abwesenheit - Alles aus"
  trigger:
    - platform: state
      entity_id: person.jonas_glawion
      to: not_home
      for:
        minutes: 10
  condition:
    - condition: state
      entity_id: input_boolean.guest_mode
      state: "off"
  action:
    - action: script.all_lights_off
    - action: climate.set_temperature
      target:
        entity_id:
          - climate.badezimmer_thermostat_bad
          - climate.wohnzimmer_thermostat_computer
      data:
        temperature: 18

# ----------------------------------------------------------------------------
# MODES
# ----------------------------------------------------------------------------
- id: sleep_mode_activate
  alias: "Schlafmodus - Aktivieren"
  trigger:
    - platform: state
      entity_id: binary_sensor.schlafzimmer_schlafzimmer_presence_sensor_bewegung
      to: "on"
      for:
        minutes: 15
  condition:
    - condition: time
      after: "22:00:00"
      before: "08:00:00"
  action:
    - action: script.all_lights_off
    - action: script.all_covers_close
    - action: climate.set_temperature
      target:
        entity_id:
          - climate.badezimmer_thermostat_bad
          - climate.wohnzimmer_thermostat_computer
      data:
        temperature: 17

- id: movie_mode_on
  alias: "Filmzeit - Aktivieren"
  trigger:
    - platform: state
      entity_id: input_boolean.movie_mode
      to: "on"
  action:
    - action: light.turn_off
      target:
        entity_id:
          - light.kuche_kueche_deckenlicht_1
          - light.kuche_kueche_deckenlicht_2
    - action: light.turn_on
      target:
        entity_id: light.wohnzimmer_wohnzimmer_buffet_lichtstreifen
      data:
        brightness_pct: 20
        color_temp_kelvin: 2200
    - action: cover.close_cover
      target:
        entity_id: cover.wohnzimmer_wohnzimmer_rollladen_vorhang
    - action: rest_command.n8n_cinema_mode

- id: movie_mode_off
  alias: "Filmzeit - Deaktivieren"
  trigger:
    - platform: state
      entity_id: input_boolean.movie_mode
      to: "off"
  action:
    - action: light.turn_on
      target:
        entity_id: light.wohnzimmer_wohnzimmer_buffet_lichtstreifen
      data:
        brightness_pct: 60
        color_temp_kelvin: 2700
        transition: 2

- id: vacation_simulation_sunset
  alias: "Urlaub - Licht an bei Sonnenuntergang"
  trigger:
    - platform: sun
      event: sunset
  condition:
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: "on"
  action:
    - action: light.turn_on
      target:
        entity_id: light.wohnzimmer_wohnzimmer_buffet_lichtstreifen
      data:
        brightness_pct: 70

# ----------------------------------------------------------------------------
# SECURITY & SAFETY
# ----------------------------------------------------------------------------
- id: security_motion_alert
  alias: "Sicherheit - Bewegung bei Abwesenheit"
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.badezimmer_badezimmer_motion_sensor
        - binary_sensor.schlafzimmer_schlafzimmer_presence_sensor_bewegung
        - binary_sensor.kuche_kueche_motion_sensor
      to: "on"
  condition:
    - condition: state
      entity_id: person.jonas_glawion
      state: not_home
      for:
        minutes: 30
  action:
    - action: notify.mobile_app_redmi_note_12_pro_5g
      data:
        title: "ðŸš¨ Bewegung erkannt!"
        message: "Bewegung in deiner Wohnung wÃ¤hrend Abwesenheit"

- id: security_door_alert
  alias: "Sicherheit - TÃ¼r geÃ¶ffnet bei Abwesenheit"
  trigger:
    - platform: state
      entity_id: binary_sensor.no_area_aqara_door_and_window_sensor_tuer
      to: "on"
  condition:
    - condition: state
      entity_id: person.jonas_glawion
      state: not_home
  action:
    - action: notify.mobile_app_redmi_note_12_pro_5g
      data:
        title: "ðŸšª TÃ¼r geÃ¶ffnet!"
        message: "Die TÃ¼r wurde geÃ¶ffnet wÃ¤hrend du nicht zuhause bist"

- id: climate_window_protection
  alias: "Heizung - Fenster offen Schutz"
  trigger:
    - platform: state
      entity_id: binary_sensor.no_area_aqara_door_and_window_sensor_tuer
      to: "on"
      for: "00:00:30"
  action:
    - action: climate.set_hvac_mode
      target:
        entity_id:
          - climate.badezimmer_thermostat_bad
          - climate.wohnzimmer_thermostat_computer
      data:
        hvac_mode: "off"
    - action: notify.mobile_app_redmi_note_12_pro_5g
      data:
        message: "Heizung aus: Fenster offen!"

# ----------------------------------------------------------------------------
# AI BRAIN
# ----------------------------------------------------------------------------
- id: ai_cleaning_tracker
  alias: "AI - Cleaning Tracker Report"
  trigger:
    - platform: state
      entity_id: input_boolean.cleaning_mode
      from: "on"
      to: "off"
  action:
    - action: rest_command.n8n_cleaning_report
      data:
        start_time: "{{ trigger.from_state.last_changed.isoformat() }}"
        end_time: "{{ now().isoformat() }}"
        hourly_rate: 25

- id: ai_voice_alert_leak
  alias: "AI - Voice Alert (Water Leak)"
  trigger:
    - platform: state
      entity_id: binary_sensor.no_area_aqara_water_leak_sensor_wasserleck
      to: "on"
  action:
    - action: rest_command.n8n_voice_notify
      data:
        message: "Critical alert. Water leak detected in the apartment. Please check immediately."
        voice_id: "Rachel"

- id: ai_morning_briefing
  alias: "AI - Morning Briefing"
  trigger:
    - platform: time
      at: "05:15:00"
  condition:
    - condition: time
      weekday: [mon, tue, wed, thu, fri]
    - condition: state
      entity_id: person.jonas_glawion
      state: "home"
  action:
    - action: rest_command.n8n_morning_briefing
