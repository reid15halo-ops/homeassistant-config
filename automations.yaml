# ============================================================================
# REID'S HOME ASSISTANT AUTOMATIONS
# Generated based on preferences - 2026-01-08
# ============================================================================

# ============================================================================
# MORNING ROUTINES
# ============================================================================

- id: "morning_wakeup_weekday"
  alias: "Morgen - Aufwachen Werktag (05:00)"
  description: "Gradual wake-up light and heating on weekdays"
  trigger:
    - platform: time
      at: "04:30"
  condition:
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
  action:
    # Start heating 30 min before wake up
    - service: climate.set_temperature
      target:
        entity_id:
          - climate.thermostat_bad
          - climate.thermostat_computer
      data:
        temperature: 23
    # Wait until actual wake up time for gradual light
    - delay:
        minutes: 30
    # Gradual wake-up light in bedroom (30 min duration)
    - service: light.turn_on
      target:
        entity_id: light.bett_licht
      data:
        brightness_pct: 5
        color_temp_kelvin: 2700
        transition: 1800 # 30 minutes gradual
    # Open bedroom shutters at wake time
    - delay:
        minutes: 30
    - service: light.turn_on
      target:
        entity_id: light.bett_licht
      data:
        brightness_pct: 80
  mode: single

- id: "morning_wakeup_weekend"
  alias: "Morgen - Aufwachen Wochenende (10:00)"
  description: "Weekend wake-up routine"
  trigger:
    - platform: time
      at: "09:30"
  condition:
    - condition: time
      weekday:
        - sat
        - sun
  action:
    # Gradual light starting 30 min before
    - service: light.turn_on
      target:
        entity_id: light.bett_licht
      data:
        brightness_pct: 5
        color_temp_kelvin: 2700
        transition: 1800
  mode: single

# ============================================================================
# ROLLER SHUTTER AUTOMATIONS
# ============================================================================

- id: "shutters_open_sunrise"
  alias: "RolllÃ¤den - Ã–ffnen bei Sonnenaufgang"
  description: "Open shutters at sunrise"
  trigger:
    - platform: sun
      event: sunrise
      offset: "00:00:00"
  condition:
    # Check if someone is likely awake or it's past earliest wake time
    - condition: or
      conditions:
        - condition: time
          after: "05:00"
          weekday:
            - mon
            - tue
            - wed
            - thu
            - fri
        - condition: time
          after: "10:00"
          weekday:
            - sat
            - sun
  action:
    - service: scene.turn_on
      target:
        entity_id: scene.rollladen
  mode: single

- id: "shutters_close_sunset_winter"
  alias: "RolllÃ¤den - SchlieÃŸen bei Sonnenuntergang (Winter)"
  description: "Close shutters at sunset in winter (Nov-Feb, no delay)"
  trigger:
    - platform: sun
      event: sunset
      offset: "00:00:00"
  condition:
    - condition: template
      value_template: "{{ now().month in [11, 12, 1, 2] }}"
  action:
    - service: cover.close_cover
      target:
        entity_id: all
  mode: single

- id: "shutters_close_sunset_spring"
  alias: "RolllÃ¤den - SchlieÃŸen bei Sonnenuntergang (FrÃ¼hling)"
  description: "Close shutters at sunset +1h in spring (Mar-Apr, Oct)"
  trigger:
    - platform: sun
      event: sunset
      offset: "01:00:00"
  condition:
    - condition: template
      value_template: "{{ now().month in [3, 4, 10] }}"
  action:
    - service: cover.close_cover
      target:
        entity_id: all
  mode: single

- id: "shutters_close_sunset_summer"
  alias: "RolllÃ¤den - SchlieÃŸen bei Sonnenuntergang (Sommer)"
  description: "Close shutters at sunset +2h in summer (May-Sep)"
  trigger:
    - platform: sun
      event: sunset
      offset: "02:00:00"
  condition:
    - condition: template
      value_template: "{{ now().month in [5, 6, 7, 8, 9] }}"
  action:
    - service: cover.close_cover
      target:
        entity_id: all
  mode: single

- id: "bedroom_shutters_sleep"
  alias: "Schlafzimmer - RolllÃ¤den schlieÃŸen bei Schlaf"
  description: "Close bedroom shutters when going to bed (presence in bed zone)"
  trigger:
    - platform: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_1
      to: "on"
      for:
        minutes: 15
  condition:
    - condition: time
      after: "22:00"
      before: "08:00"
    # Only if no one else detected elsewhere (sleep mode)
    - condition: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_2
      state: "off"
    - condition: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_3
      state: "off"
  action:
    - service: cover.close_cover
      target:
        entity_id: cover.rollladen_schlafen_vorhang
  mode: single

# ============================================================================
# MOTION-BASED LIGHTING
# ============================================================================

- id: "light_wohnzimmer_presence"
  alias: "Wohnzimmer - Licht bei PrÃ¤senz"
  description: "Turn on living room lights when FP2 detects presence"
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_1
        - binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_2
      to: "on"
  condition:
    # Only when dark (using FP2 light sensor)
    - condition: numeric_state
      entity_id: sensor.presence_sensor_fp2_f9cf_light_sensor_light_level
      below: 50
  action:
    - service: light.turn_on
      target:
        entity_id:
          - light.computer_licht
          - light.buffet_lichtstreifen
      data:
        brightness_pct: "{{ 60 if now().hour >= 22 or now().hour < 6 else 80 }}"
        color_temp_kelvin: 2700
  mode: single

- id: "light_wohnzimmer_off_no_presence"
  alias: "Wohnzimmer - Licht aus ohne PrÃ¤senz"
  description: "Turn off living room lights after 120s no presence"
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_1
        - binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_2
        - binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_3
        - binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_4
        - binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_5
      to: "off"
      for:
        seconds: 120
  condition:
    # All presence zones must be off
    - condition: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_1
      state: "off"
    - condition: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_2
      state: "off"
  action:
    - service: light.turn_off
      target:
        entity_id:
          - light.computer_licht
          - light.buffet_lichtstreifen
  mode: single

- id: "light_kuche_on"
  alias: "KÃ¼che - Licht an bei Bewegung"
  description: "Turn on kitchen lights when presence detected"
  trigger:
    - platform: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_3
      to: "on"
  condition:
    - condition: numeric_state
      entity_id: sensor.presence_sensor_fp2_f9cf_light_sensor_light_level
      below: 50
  action:
    - service: light.turn_on
      target:
        entity_id:
          - light.kuche_birne_1
          - light.kuche_birne_2
          - light.kuche_streifen
      data:
        brightness_pct: "{{ 50 if now().hour >= 22 else 100 }}"
        color_temp_kelvin: 2700
  mode: single

- id: "light_kuche_off"
  alias: "KÃ¼che - Licht aus ohne Bewegung"
  description: "Turn off kitchen lights after 120s no presence"
  trigger:
    - platform: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_3
      to: "off"
      for:
        seconds: 120
  action:
    - service: light.turn_off
      target:
        entity_id:
          - light.kuche_birne_1
          - light.kuche_birne_2
          - light.kuche_streifen
  mode: single

- id: "light_bad_on"
  alias: "Bad - Licht an bei Bewegung"
  description: "Turn on bathroom light when presence detected"
  trigger:
    - platform: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_4
      to: "on"
  action:
    - service: light.turn_on
      target:
        entity_id: light.bad
      data:
        brightness_pct: "{{ 10 if now().hour >= 22 or now().hour < 6 else 100 }}"
        color_temp_kelvin: 2700
  mode: single

- id: "light_bad_off"
  alias: "Bad - Licht aus ohne Bewegung"
  description: "Turn off bathroom light after 120s no presence"
  trigger:
    - platform: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_4
      to: "off"
      for:
        seconds: 120
  action:
    - service: light.turn_off
      target:
        entity_id: light.bad
  mode: single

# ============================================================================
# HEATING AUTOMATIONS
# ============================================================================

- id: "heating_presence_on"
  alias: "Heizung - Komfort bei Anwesenheit"
  description: "Set heating to comfort when home"
  trigger:
    - platform: state
      entity_id: person.reid15
      to: "home"
  condition:
    # Only in heating season (Oct-Apr)
    - condition: template
      value_template: "{{ now().month in [1, 2, 3, 4, 10, 11, 12] }}"
  action:
    - service: climate.set_temperature
      target:
        entity_id:
          - climate.thermostat_bad
          - climate.thermostat_computer
      data:
        temperature: "{{ 23 if now().month in [11, 12, 1, 2] else 22 }}"
  mode: single

- id: "heating_away_eco"
  alias: "Heizung - Eco bei Abwesenheit"
  description: "Set heating to eco when away"
  trigger:
    - platform: state
      entity_id: person.reid15
      to: "not_home"
      for:
        minutes: 10
  action:
    - service: climate.set_temperature
      target:
        entity_id:
          - climate.thermostat_bad
          - climate.thermostat_computer
      data:
        temperature: 18
  mode: single

- id: "heating_night_mode"
  alias: "Heizung - Nachtmodus"
  description: "Reduce heating at night"
  trigger:
    - platform: time
      at: "22:00"
  condition:
    - condition: template
      value_template: "{{ now().month in [1, 2, 3, 4, 10, 11, 12] }}"
  action:
    - service: climate.set_temperature
      target:
        entity_id:
          - climate.thermostat_bad
          - climate.thermostat_computer
      data:
        temperature: 17
  mode: single

# ============================================================================
# AWAY MODE & ROBOROCK
# ============================================================================

- id: "roborock_clean_workday"
  alias: "Roborock - Reinigung an Werktagen (12:00)"
  description: "Start vacuum when away on workdays at 12:00"
  trigger:
    - platform: time
      at: "12:00:00"
  condition:
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
    - condition: state
      entity_id: person.reid15
      state: "not_home"
  action:
    - service: vacuum.start
      target:
        entity_id: vacuum.roborock_q7_max
  mode: single

- id: "roborock_stop_on_arrival"
  alias: "Roborock - Stopp bei Heimkehr"
  description: "Stop vacuum and return to dock when arriving home"
  trigger:
    - platform: state
      entity_id: person.reid15
      to: "home"
  condition:
    - condition: state
      entity_id: vacuum.roborock_q7_max
      state: "cleaning"
  action:
    - service: vacuum.return_to_base
      target:
        entity_id: vacuum.roborock_q7_max
  mode: single

# ============================================================================
# WELCOME HOME
# ============================================================================

- id: "welcome_home"
  alias: "Willkommen - Licht an bei Heimkehr"
  description: "Turn on lights when arriving home"
  trigger:
    - platform: state
      entity_id: person.reid15
      to: "home"
  condition:
    # Only when dark
    - condition: sun
      after: sunset
      before: sunrise
  action:
    - service: light.turn_on
      target:
        entity_id:
          - light.computer_licht
          - light.buffet_lichtstreifen
      data:
        brightness_pct: 80
        color_temp_kelvin: 2700
    # Boost heating in winter
    - choose:
        - conditions:
            - condition: template
              value_template: "{{ now().month in [11, 12, 1, 2] }}"
          sequence:
            - service: climate.set_temperature
              target:
                entity_id:
                  - climate.thermostat_bad
                  - climate.thermostat_computer
              data:
                temperature: 23
  mode: single

# ============================================================================
# AWAY MODE
# ============================================================================

- id: "away_mode_activate"
  alias: "Abwesenheit - Alles aus"
  description: "Turn off lights and reduce heating when leaving"
  trigger:
    - platform: state
      entity_id: person.reid15
      to: "not_home"
      for:
        minutes: 10
  action:
    - service: light.turn_off
      target:
        entity_id: all
    - service: climate.set_temperature
      target:
        entity_id:
          - climate.thermostat_bad
          - climate.thermostat_computer
      data:
        temperature: 18
  mode: single

# ============================================================================
# SLEEP MODE
# ============================================================================

- id: "sleep_mode"
  alias: "Schlafmodus - Aktivieren"
  description: "Sleep mode when in bedroom for 15 min at night"
  trigger:
    - platform: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_5
      to: "on"
      for:
        minutes: 15
  condition:
    - condition: time
      after: "22:00"
      before: "08:00"
    # No one in other zones
    - condition: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_1
      state: "off"
    - condition: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_2
      state: "off"
    - condition: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_3
      state: "off"
    - condition: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_4
      state: "off"
  action:
    # Turn off all lights
    - service: light.turn_off
      target:
        entity_id: all
    # Night temperature
    - service: climate.set_temperature
      target:
        entity_id:
          - climate.thermostat_bad
          - climate.thermostat_computer
      data:
        temperature: 17
    # Close all shutters
    - service: cover.close_cover
      target:
        entity_id: all
  mode: single

# ============================================================================
# MOVIE MODE
# ============================================================================

- id: "movie_mode"
  alias: "Filmzeit - Aktivieren"
  description: "Movie mode - dim lights, close shutters, ambient on"
  trigger:
    - platform: state
      entity_id: input_boolean.movie_mode
      to: "on"
  action:
    # Dim main lights
    - service: light.turn_off
      target:
        entity_id: light.kuche_birne_1
    - service: light.turn_off
      target:
        entity_id: light.kuche_birne_2
    # Ambient lights on low
    - service: light.turn_on
      target:
        entity_id: light.buffet_lichtstreifen
      data:
        brightness_pct: 20
        color_temp_kelvin: 2200
    # Dim computer light
    - service: light.turn_on
      target:
        entity_id: light.computer_licht
      data:
        brightness_pct: 10
        color_temp_kelvin: 2200
    # Close shutters in living room
    - service: cover.close_cover
      target:
        entity_id: cover.rollladen_computer_vorhang
  mode: single

- id: "movie_mode_off"
  alias: "Filmzeit - Deaktivieren"
  description: "End movie mode"
  trigger:
    - platform: state
      entity_id: input_boolean.movie_mode
      to: "off"
  action:
    - service: light.turn_on
      target:
        entity_id:
          - light.computer_licht
          - light.buffet_lichtstreifen
      data:
        brightness_pct: 60
        color_temp_kelvin: 2700
  mode: single

# ============================================================================
# GUEST MODE
# ============================================================================

- id: "guest_mode_on"
  alias: "GÃ¤stemodus - LÃ¤ngere Timeouts"
  description: "Disable automatic shutters and keep lights on longer when guests"
  # This is controlled manually via input_boolean.guest_mode
  trigger:
    - platform: state
      entity_id: input_boolean.guest_mode
      to: "on"
  action:
    - service: automation.turn_off
      target:
        entity_id: automation.rollladen_schliessen_bei_sonnenuntergang_winter
  mode: single

# ============================================================================
# SUN PROTECTION
# ============================================================================

- id: "sun_protection"
  alias: "Sonnenschutz - RolllÃ¤den bei Hitze"
  description: "Close shutters when too hot"
  trigger:
    - platform: numeric_state
      entity_id: sensor.openweathermap_temperature
      above: 25
  condition:
    - condition: sun
      after: sunrise
      before: sunset
  action:
    - service: cover.close_cover
      target:
        entity_id: all
  mode: single

# ============================================================================
# VACATION MODE
# ============================================================================

- id: "vacation_presence_simulation"
  alias: "Urlaub - Anwesenheitssimulation"
  description: "Simulate presence when on vacation"
  trigger:
    - platform: state
      entity_id: input_boolean.vacation_mode
      to: "on"
  action:
    - repeat:
        while:
          - condition: state
            entity_id: input_boolean.vacation_mode
            state: "on"
        sequence:
          # Random light on
          - service: light.turn_on
            target:
              entity_id: "{{ ['light.computer_licht', 'light.buffet_lichtstreifen', 'light.kuche_birne_1'] | random }}"
            data:
              brightness_pct: "{{ range(50, 100) | random }}"
          - delay:
              minutes: "{{ range(30, 120) | random }}"
          # Random light off
          - service: light.turn_off
            target:
              entity_id: "{{ ['light.computer_licht', 'light.buffet_lichtstreifen', 'light.kuche_birne_1'] | random }}"
          - delay:
              minutes: "{{ range(15, 60) | random }}"
  mode: single

# ============================================================================
# SECURITY ALERTS
# ============================================================================

- id: "security_motion_alert"
  alias: "Sicherheit - Bewegung bei Abwesenheit"
  description: "Alert when motion detected while away"
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_1
        - binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_2
        - binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_3
      to: "on"
  condition:
    - condition: state
      entity_id: person.reid15
      state: "not_home"
      for:
        minutes: 30
  action:
    - service: notify.mobile_app_redmi_note_12_pro_5g
      data:
        title: "âš ï¸ Bewegung erkannt!"
        message: "Bewegung in deiner Wohnung wÃ¤hrend Abwesenheit"
  mode: single

- id: "security_door_alert"
  alias: "Sicherheit - TÃ¼r geÃ¶ffnet bei Abwesenheit"
  description: "Alert when door opens while away"
  trigger:
    - platform: state
      entity_id: binary_sensor.contact_sensor
      to: "on"
  condition:
    - condition: state
      entity_id: person.reid15
      state: "not_home"
  action:
    - service: notify.mobile_app_redmi_note_12_pro_5g
      data:
        title: "ðŸšª TÃ¼r geÃ¶ffnet!"
        message: "Die TÃ¼r wurde geÃ¶ffnet wÃ¤hrend du nicht zuhause bist"
  mode: single
# ============================================================================
# REID'S GAMING AUTOMATIONS
# For optimal gaming experience
# ============================================================================

# ============================================================================
# GAMING MODE - Auto-detect when gaming
# ============================================================================

- id: "gaming_mode_activate"
  alias: "Gaming - Modus aktivieren"
  description: "Activate gaming mode when sitting at computer for 5 minutes"
  trigger:
    - platform: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_1
      to: "on"
      for:
        minutes: 5
  condition:
    - condition: time
      after: "08:00"
      before: "03:00"
  action:
    # Turn on gaming mode
    - service: input_boolean.turn_on
      target:
        entity_id: input_boolean.gaming_mode
    # Set computer light to gaming red
    - service: light.turn_on
      target:
        entity_id: light.computer_licht
      data:
        brightness_pct: 30
        rgb_color: [255, 0, 0] # Red for gaming
    # Dim buffet light for ambient
    - service: light.turn_on
      target:
        entity_id: light.buffet_lichtstreifen
      data:
        brightness_pct: 15
        rgb_color: [255, 50, 0] # Orange-red ambient
    # Turn off kitchen lights (no glare)
    - service: light.turn_off
      target:
        entity_id:
          - light.kuche_birne_1
          - light.kuche_birne_2
  mode: single

- id: "gaming_mode_deactivate"
  alias: "Gaming - Modus deaktivieren"
  description: "Deactivate gaming mode when leaving computer area"
  trigger:
    - platform: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_1
      to: "off"
      for:
        minutes: 10
  condition:
    - condition: state
      entity_id: input_boolean.gaming_mode
      state: "on"
  action:
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.gaming_mode
    # Restore normal lighting
    - service: light.turn_on
      target:
        entity_id:
          - light.computer_licht
          - light.buffet_lichtstreifen
      data:
        brightness_pct: 60
        color_temp_kelvin: 2700
  mode: single

# ============================================================================
# ANTI-GLARE - Close shutters for daytime gaming
# ============================================================================

- id: "gaming_anti_glare"
  alias: "Gaming - Blendschutz bei Tag"
  description: "Close computer shutter when gaming during bright day"
  trigger:
    - platform: state
      entity_id: input_boolean.gaming_mode
      to: "on"
  condition:
    # Only during daytime
    - condition: sun
      after: sunrise
      before: sunset
    # And when it's bright outside
    - condition: numeric_state
      entity_id: sensor.presence_sensor_fp2_f9cf_light_sensor_light_level
      above: 100
  action:
    - service: cover.close_cover
      target:
        entity_id: cover.rollladen_computer_vorhang
  mode: single

- id: "gaming_restore_shutter"
  alias: "Gaming - Rollladen Ã¶ffnen nach Gaming"
  description: "Open shutter when gaming mode ends during day"
  trigger:
    - platform: state
      entity_id: input_boolean.gaming_mode
      to: "off"
  condition:
    - condition: sun
      after: sunrise
      before: sunset
  action:
    - delay:
        minutes: 2
    - service: cover.open_cover
      target:
        entity_id: cover.rollladen_computer_vorhang
  mode: single

# ============================================================================
# GAMING BREAK REMINDER
# ============================================================================

- id: "gaming_break_reminder_2h"
  alias: "Gaming - Pause Erinnerung (2 Stunden)"
  description: "Remind to take a break after 2 hours of gaming"
  trigger:
    - platform: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_1
      to: "on"
      for:
        hours: 2
  condition:
    - condition: state
      entity_id: input_boolean.gaming_mode
      state: "on"
  action:
    # Flash lights briefly
    - service: light.turn_on
      target:
        entity_id: light.buffet_lichtstreifen
      data:
        brightness_pct: 100
        rgb_color: [0, 255, 0] # Green flash
    - delay:
        seconds: 2
    - service: light.turn_on
      target:
        entity_id: light.buffet_lichtstreifen
      data:
        brightness_pct: 15
        rgb_color: [255, 50, 0] # Back to gaming ambient
    # Send notification
    - service: notify.mobile_app_redmi_note_12_pro_5g
      data:
        title: "ðŸŽ® Gaming Pause!"
        message: "Du zockst seit 2 Stunden. Zeit fÃ¼r eine kurze Pause!"
  mode: single

- id: "gaming_break_reminder_4h"
  alias: "Gaming - Pause Erinnerung (4 Stunden)"
  description: "Stronger reminder after 4 hours"
  trigger:
    - platform: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_1
      to: "on"
      for:
        hours: 4
  condition:
    - condition: state
      entity_id: input_boolean.gaming_mode
      state: "on"
  action:
    # More noticeable flash
    - repeat:
        count: 3
        sequence:
          - service: light.turn_on
            target:
              entity_id: light.buffet_lichtstreifen
            data:
              brightness_pct: 100
              rgb_color: [255, 165, 0] # Orange
          - delay:
              seconds: 1
          - service: light.turn_on
            target:
              entity_id: light.buffet_lichtstreifen
            data:
              brightness_pct: 20
              rgb_color: [255, 0, 0]
          - delay:
              seconds: 1
    # Send notification
    - service: notify.mobile_app_redmi_note_12_pro_5g
      data:
        title: "âš ï¸ 4 Stunden Gaming!"
        message: "Steh auf, streck dich, trink Wasser! Dein RÃ¼cken wird es dir danken."
  mode: single

# ============================================================================
# SNACK BREAK - Don't change lights when getting snacks
# ============================================================================

- id: "gaming_snack_break"
  alias: "Gaming - Snack Pause (KÃ¼che)"
  description: "Keep gaming lights when briefly going to kitchen"
  trigger:
    - platform: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_3 # Kitchen
      to: "on"
  condition:
    - condition: state
      entity_id: input_boolean.gaming_mode
      state: "on"
  action:
    # Just turn on kitchen light, don't change anything else
    - service: light.turn_on
      target:
        entity_id: light.kuche_streifen
      data:
        brightness_pct: 50
        color_temp_kelvin: 2700
  mode: single

- id: "gaming_snack_return"
  alias: "Gaming - RÃ¼ckkehr von Snack Pause"
  description: "Turn off kitchen light when returning to gaming"
  trigger:
    - platform: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_1 # Computer
      to: "on"
  condition:
    - condition: state
      entity_id: input_boolean.gaming_mode
      state: "on"
    - condition: state
      entity_id: light.kuche_streifen
      state: "on"
  action:
    - delay:
        seconds: 30
    - service: light.turn_off
      target:
        entity_id:
          - light.kuche_streifen
          - light.kuche_birne_1
          - light.kuche_birne_2
  mode: single

# ============================================================================
# NIGHT GAMING - Eye comfort mode
# ============================================================================

- id: "gaming_night_mode"
  alias: "Gaming - Nachtmodus (Augenkomfort)"
  description: "Warmer lighting after 22:00 for eye comfort"
  trigger:
    - platform: time
      at: "22:00"
  condition:
    - condition: state
      entity_id: input_boolean.gaming_mode
      state: "on"
  action:
    # Warmer, dimmer gaming lights
    - service: light.turn_on
      target:
        entity_id: light.computer_licht
      data:
        brightness_pct: 20
        rgb_color: [255, 100, 50] # Warmer red-orange
    - service: light.turn_on
      target:
        entity_id: light.buffet_lichtstreifen
      data:
        brightness_pct: 10
        color_temp_kelvin: 2200
    # Notification
    - service: notify.mobile_app_redmi_note_12_pro_5g
      data:
        title: "ðŸŒ™ Nacht-Gaming-Modus"
        message: "Lichter wurden wÃ¤rmer & dunkler fÃ¼r deine Augen."
  mode: single

# ============================================================================
# STREAM MODE - Perfect lighting for streaming
# ============================================================================

- id: "stream_mode_activate"
  alias: "Streaming - Modus aktivieren"
  description: "Optimal lighting for streaming/video calls"
  trigger:
    - platform: state
      entity_id: input_boolean.stream_mode
      to: "on"
  action:
    # Bright, neutral lighting for camera
    - service: light.turn_on
      target:
        entity_id: light.computer_licht
      data:
        brightness_pct: 80
        color_temp_kelvin: 4000 # Neutral white
    # Ambient background
    - service: light.turn_on
      target:
        entity_id: light.buffet_lichtstreifen
      data:
        brightness_pct: 40
        rgb_color: [100, 50, 200] # Purple accent background
    # Close shutter to prevent backlight
    - service: cover.close_cover
      target:
        entity_id: cover.rollladen_computer_vorhang
  mode: single

- id: "stream_mode_deactivate"
  alias: "Streaming - Modus deaktivieren"
  description: "Return to gaming mode after stream"
  trigger:
    - platform: state
      entity_id: input_boolean.stream_mode
      to: "off"
  action:
    # Back to gaming lights
    - service: light.turn_on
      target:
        entity_id: light.computer_licht
      data:
        brightness_pct: 30
        rgb_color: [255, 0, 0]
    - service: light.turn_on
      target:
        entity_id: light.buffet_lichtstreifen
      data:
        brightness_pct: 15
        rgb_color: [255, 50, 0]
  mode: single

# ============================================================================
# AFK DETECTION
# ============================================================================

- id: "gaming_afk_detected"
  alias: "Gaming - AFK erkannt"
  description: "Detect when AFK during gaming"
  trigger:
    - platform: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_1
      to: "off"
      for:
        minutes: 15
  condition:
    - condition: state
      entity_id: input_boolean.gaming_mode
      state: "on"
  action:
    # Dim lights to save energy
    - service: light.turn_on
      target:
        entity_id: light.computer_licht
      data:
        brightness_pct: 5
    - service: light.turn_off
      target:
        entity_id: light.buffet_lichtstreifen
  mode: single

- id: "gaming_afk_return"
  alias: "Gaming - ZurÃ¼ck von AFK"
  description: "Restore lights when returning from AFK"
  trigger:
    - platform: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_1
      to: "on"
  condition:
    - condition: state
      entity_id: input_boolean.gaming_mode
      state: "on"
    - condition: numeric_state
      entity_id: light.computer_licht
      attribute: brightness
      below: 30
  action:
    # Restore gaming lights
    - service: light.turn_on
      target:
        entity_id: light.computer_licht
      data:
        brightness_pct: 30
        rgb_color: [255, 0, 0]
    - service: light.turn_on
      target:
        entity_id: light.buffet_lichtstreifen
      data:
        brightness_pct: 15
        rgb_color: [255, 50, 0]
  mode: single

# ============================================================================
# RAGE QUIT DETECTION (just for fun!)
# ============================================================================

- id: "gaming_rage_quit"
  alias: "Gaming - Rage Quit erkannt ðŸ˜¤"
  description: "Detect sudden exit from gaming (rage quit)"
  trigger:
    - platform: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_1
      to: "off"
  condition:
    - condition: state
      entity_id: input_boolean.gaming_mode
      state: "on"
    # Check if nearby presence (couch) within 10 seconds
    - condition: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_2
      state: "on"
  action:
    - delay:
        seconds: 5
    # Check if went to couch (rage quit to decompress)
    - condition: state
      entity_id: binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_2
      state: "on"
    # Calming lights
    - service: light.turn_on
      target:
        entity_id:
          - light.computer_licht
          - light.buffet_lichtstreifen
      data:
        brightness_pct: 40
        rgb_color: [50, 100, 255] # Calming blue
        transition: 5
  mode: single
