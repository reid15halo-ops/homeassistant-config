# ============================================================================
# BEREINIGTE SCRIPTS.YAML
# Duplikate entfernt - nur die aktive Version behalten
# ============================================================================

ambient_feuerlicht_warm_flicker:
  alias: KL430 - Random Fire (Amber + Dynamic Dim)
  mode: restart
  sequence:
    - target:
        entity_id:
          - light.computer_licht
          - light.buffet_lichtstreifen
      data:
        init_states: 30,55,62
        backgrounds:
          - [28, 50, 62]
          - [31, 45, 74]
          - [33, 35, 88]
          - [26, 55, 66]
        segments: 0
        brightness: 70
        transition: 900
        transition_range: 500,1500
        hue_range: 26,42
        saturation_range: 35,70
        brightness_range: 10,92
        random_seed: 321
      action: tplink.random_effect

ambient_velvet_rainbow:
  alias: Ambient – Velvet Rainbow
  mode: restart
  sequence:
    - variables:
        hue: 12
        sat: 55
        bri: 46
        step_h: 2
        t: 3
    - repeat:
        count: 100000
        sequence:
          - target:
              entity_id: light.computer_licht
            data:
              hs_color:
                - "{{ hue }}"
                - "{{ sat }}"
              brightness_pct: "{{ bri }}"
              transition: "{{ t }}"
            action: light.turn_on
          - delay: "{{ t }}"
          - variables:
              hue: "{{ (hue + step_h) % 360 }}"

ventilator_wintermodus_low:
  alias: Ventilator – Wintermodus Low
  mode: single
  sequence:
    - action: fan.decrease_speed
      target:
        entity_id:
          - fan.ceiling_fan_with_light
      data:
        percentage_step: 9
    - type: toggle
      device_id: 3586709559e4e46394dfa54ebf906373
      entity_id: a14baab7198c0de3311dbee8b11fedab
      domain: fan

notify_all:
  alias: Notify All Devices
  mode: parallel
  max: 10
  fields:
    message:
      description: Message to send
      required: true
    title:
      description: Notification title
      required: false
  sequence:
    - service: notify.alexa_media_wohnzimmer
      data:
        title: "{{ title | default('Home Assistant') }}"
        message: "{{ message }}"
      continue_on_error: true

lights_bedtime:
  alias: Bedtime Light Scene
  mode: single
  sequence:
    - service: light.turn_off
      target:
        area_id: all
      continue_on_error: true
    - service: light.turn_on
      target:
        entity_id: light.schlafzimmer_licht
      data:
        brightness_pct: "{{ states('input_number.night_mode_brightness')|int(15) }}"
        color_temp_kelvin: 2700
      continue_on_error: true

all_lights_off:
  alias: Turn Off All Lights
  mode: single
  sequence:
    - service: light.turn_off
      target:
        entity_id: all
      continue_on_error: true

all_covers_open:
  alias: Open All Covers
  mode: single
  fields:
    position:
      description: Target position (0-100)
      default: 100
  sequence:
    - service: cover.set_cover_position
      target:
        entity_id:
          - cover.rollladen_computer_vorhang
          - cover.rollladen_kuche_vorhang
          - cover.rollladen_yoga_vorhang
          - cover.rollladen_schlafen_vorhang
      data:
        position: "{{ position }}"
      continue_on_error: true

all_covers_close:
  alias: Close All Covers
  mode: single
  sequence:
    - service: cover.close_cover
      target:
        entity_id:
          - cover.rollladen_computer_vorhang
          - cover.rollladen_kuche_vorhang
          - cover.rollladen_yoga_vorhang
          - cover.rollladen_schlafen_vorhang
      continue_on_error: true

light_toggle_with_brightness:
  alias: Toggle Light with Smart Brightness
  mode: single
  fields:
    target_light:
      description: Light entity to toggle
      required: true
    brightness_day:
      default: 100
    brightness_night:
      default: 15
  sequence:
    - choose:
        - conditions:
            - condition: template
              value_template: "{{ is_state(target_light, 'on') }}"
          sequence:
            - service: light.turn_off
              target:
                entity_id: "{{ target_light }}"
      default:
        - service: light.turn_on
          target:
            entity_id: "{{ target_light }}"
          data:
            brightness_pct: >
              {% set hour = now().hour %}
              {% if hour >= 22 or hour < 6 %}
                {{ brightness_night }}
              {% else %}
                {{ brightness_day }}
              {% endif %}
