# ============================================================================
# REID'S HOME ASSISTANT - COMPLETE CONFIGURATION
# Generated: 2026-01-08
# ============================================================================

homeassistant:
  name: Zuhause
  latitude: 49.91
  longitude: 9.08
  elevation: 150
  unit_system: metric
  time_zone: Europe/Berlin
  external_url: "https://reid15.duckdns.org"
  internal_url: "http://192.168.178.70:8123"
  packages:
    plant_growing: !include packages/plant_growing.yaml
    system_health: !include packages/system_health.yaml
    ai_generated: !include packages/ai_generated.yaml
    jarvis_agent: !include packages/jarvis_agent.yaml
    tp_link_fixes: !include packages/tp_link_fixes.yaml
    presence_agent: !include packages/presence_agent.yaml
    system_agent: !include packages/system_agent.yaml
    light_agent: !include packages/light_agent.yaml
    blind_agent: !include packages/blind_agent.yaml
    climate_agent: !include packages/climate_agent.yaml

# Mobile App - Required for Companion App functionality
mobile_app:

# Standard includes
automation: !include automations.yaml
script: !include scripts.yaml
scene: !include scenes.yaml
input_boolean: !include input_boolean.yaml

# Lovelace Dashboards
lovelace:
  mode: yaml
  resources: [] # Clear resources
  dashboards:
    lovelace-home:
      mode: yaml
      title: Home Control
      icon: mdi:home-automation
      show_in_sidebar: true
      filename: dashboards/home_control.yaml
      require_admin: false
    lovelace-climate:
      mode: yaml
      title: Climate & Energy
      icon: mdi:leaf
      show_in_sidebar: true
      filename: dashboards/climate_energy.yaml
    lovelace-status:
      mode: yaml
      title: Automation Status
      icon: mdi:robot
      show_in_sidebar: true
      filename: dashboards/automation_status.yaml
    lovelace-plants:
      mode: yaml
      title: Plant Growing
      icon: mdi:sprout
      show_in_sidebar: true
      filename: dashboards/plant_growing.yaml

# ZHA Configuration
zha:
  enable_quirks: true
  custom_quirks_path: /config/custom_zha_quirks

# Logger
logger:
  default: warning
  logs:
    homeassistant.components.zha: debug
    zhaquirks: debug
    zigpy: debug

# Recorder - keeps DB small
recorder:
  purge_keep_days: 7
  commit_interval: 1
  auto_purge: true
  auto_repack: true
  exclude:
    domains:
      - automation
      - updater
      - camera
    entity_globs:
      - sensor.*_rssi
      - sensor.*_lqi
      - sensor.*_linkquality
    entities:
      - sun.sun
      - sensor.time
      - sensor.date

energy:
default_config:
bluetooth:

# HTTP configuration
# NOTE: SSL is commented out until DuckDNS add-on generates certificates
# Once /ssl/fullchain.pem exists, uncomment the ssl lines below
http:
  ssl_certificate: /ssl/fullchain.pem
  ssl_key: /ssl/privkey.pem
  use_x_forwarded_for: true
  trusted_proxies:
    - 0.0.0.0/0

# ============================================================================
# REST COMMANDS - Connection to n8n (AI Brain)
# ============================================================================
rest_command:
  n8n_grow_bot_check:
    url: "http://192.168.178.49:5678/webhook/grow-bot-check"
    method: POST
    payload: '{"temperature": {{ temperature }}, "humidity": {{ humidity }}, "stage": "{{ stage }}", "timestamp": "{{ timestamp }}"}'
    content_type: "application/json"

  n8n_cleaning_report:
    url: "http://192.168.178.49:5678/webhook/cleaning-report"
    method: POST
    payload: '{"start_time": "{{ start_time }}", "end_time": "{{ end_time }}", "hourly_rate": {{ hourly_rate }}}'
    content_type: "application/json"

  n8n_voice_notify:
    url: "http://192.168.178.49:5678/webhook/voice-notify"
    method: POST
    payload: '{"message": "{{ message }}", "voice_id": "{{ voice_id }}"}'
    content_type: "application/json"

  n8n_morning_briefing:
    url: "http://192.168.178.49:5678/webhook/morning-briefing"
    method: POST
    content_type: "application/json"

  n8n_cinema_mode:
    url: "http://192.168.178.49:5678/webhook/cinema-mode"
    method: POST
    payload: '{"mode": "on", "timestamp": "{{ now().isoformat() }}"}'
    content_type: "application/json"

# ============================================================================
# INPUT NUMBER - Rollläden & Heizung
# ============================================================================

# ============================================================================
# INPUT SELECT - Szenen & Modi
# ============================================================================

# ============================================================================
# TEMPLATE - Modern Syntax
# ============================================================================
template:
  - sensor:
      - name: "Aktuelle Jahreszeit"
        unique_id: aktuelle_jahreszeit
        state: >
          {% set month = now().month %}
          {% if month in [3, 4, 5] %}
            Frühling
          {% elif month in [6, 7, 8] %}
            Sommer
          {% elif month in [9, 10, 11] %}
            Herbst
          {% else %}
            Winter
          {% endif %}
        icon: >
          {% set month = now().month %}
          {% if month in [3, 4, 5] %}
            mdi:flower
          {% elif month in [6, 7, 8] %}
            mdi:white-balance-sunny
          {% elif month in [9, 10, 11] %}
            mdi:leaf
          {% else %}
            mdi:snowflake
          {% endif %}

  - binary_sensor:
      - name: "Sommerbetrieb (Außentemperatur)"
        unique_id: sommerbetrieb_ortsbasiert
        state: "{{ state_attr('weather.forecast_home', 'temperature')|float(0) > 18 }}"
        icon: >
          {% if state_attr('weather.forecast_home', 'temperature')|float(0) > 18 %}
            mdi:weather-sunny
          {% else %}
            mdi:snowflake
          {% endif %}

# ============================================================================
# ============================================================================
# BINARY SENSOR - Templates (migrated to template:)
# ============================================================================

# ============================================================================
# NOTIFY - Groups
# ============================================================================
notify:
  - platform: group
    name: alle_geraete
    services:
      - service: mobile_app_redmi_note_12_pro_5g
