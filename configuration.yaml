# ============================================================================
# REID'S HOME ASSISTANT - COMPLETE CONFIGURATION
# Generated: 2026-01-08
# ============================================================================

homeassistant:
  name: Zuhause
  latitude: 49.91
  longitude: 9.08
  elevation: 150
  unit_system: metric
  time_zone: Europe/Berlin
  external_url: "https://reid15.duckdns.org:8123"
  internal_url: "https://192.168.178.70:8123"

# Standard includes
automation: !include automations.yaml
script: !include scripts.yaml
scene: !include scenes.yaml

# Lovelace Dashboards
lovelace:
  mode: storage
  dashboards:
    home-control:
      mode: yaml
      title: Home Control
      icon: mdi:home-automation
      show_in_sidebar: true
      filename: dashboards/home_control.yaml
    climate-energy:
      mode: yaml
      title: Climate & Energy
      icon: mdi:leaf
      show_in_sidebar: true
      filename: dashboards/climate_energy.yaml
    automation-status:
      mode: yaml
      title: Automation Status
      icon: mdi:robot
      show_in_sidebar: true
      filename: dashboards/automation_status.yaml
    plant-growing:
      mode: yaml
      title: Plant Growing
      icon: mdi:sprout
      show_in_sidebar: true
      filename: dashboards/plant_growing.yaml

# ZHA Configuration
zha:
  enable_quirks: true
  custom_quirks_path: /config/custom_zha_quirks

# Logger
logger:
  default: warning
  logs:
    homeassistant.components.zha: warning
    zhaquirks: warning
    zigpy: warning

# Recorder - keeps DB small
recorder:
  purge_keep_days: 7
  commit_interval: 1
  auto_purge: true
  auto_repack: true
  exclude:
    domains:
      - automation
      - updater
      - camera
    entity_globs:
      - sensor.*_rssi
      - sensor.*_lqi
      - sensor.*_linkquality
    entities:
      - sun.sun
      - sensor.time
      - sensor.date

energy:
default_config:
bluetooth:

# HTTP with SSL
http:
  ssl_certificate: /ssl/fullchain.pem
  ssl_key: /ssl/privkey.pem
  use_x_forwarded_for: true
  trusted_proxies:
    - 0.0.0.0/0

# ============================================================================
# INPUT NUMBER - Rollläden & Heizung
# ============================================================================
input_number:
  # Rollladen Position Tracking
  pos_computer:
    name: "Rollladen Computer Position"
    min: 0
    max: 100
    step: 1
    unit_of_measurement: "%"
    mode: box
    icon: mdi:window-shutter
  pos_kuche:
    name: "Rollladen Küche Position"
    min: 0
    max: 100
    step: 1
    unit_of_measurement: "%"
    mode: box
    icon: mdi:window-shutter
  pos_yoga:
    name: "Rollladen Yoga Position"
    min: 0
    max: 100
    step: 1
    unit_of_measurement: "%"
    mode: box
    icon: mdi:window-shutter
  pos_schlafen:
    name: "Rollladen Schlafzimmer Position"
    min: 0
    max: 100
    step: 1
    unit_of_measurement: "%"
    mode: box
    icon: mdi:window-shutter

  # Heizung Sollwerte
  heizung_solltemperatur_komfort:
    name: "Heizung Komfort-Temperatur"
    min: 18
    max: 25
    step: 0.5
    initial: 23
    unit_of_measurement: "°C"
    mode: slider
    icon: mdi:thermometer
  heizung_solltemperatur_eco:
    name: "Heizung Eco-Temperatur"
    min: 16
    max: 20
    step: 0.5
    initial: 18
    unit_of_measurement: "°C"
    mode: slider
    icon: mdi:thermometer-low
  heizung_solltemperatur_nacht:
    name: "Heizung Nacht-Temperatur"
    min: 15
    max: 19
    step: 0.5
    initial: 17
    unit_of_measurement: "°C"
    mode: slider
    icon: mdi:thermometer-low

  # Motion Timeout
  motion_timeout:
    name: "Bewegungsmelder Timeout"
    min: 30
    max: 600
    step: 30
    initial: 120
    unit_of_measurement: "sec"
    mode: slider
    icon: mdi:timer

# ============================================================================
# INPUT BOOLEAN - Modi & Schalter
# ============================================================================
input_boolean:
  # Heizungsmodi
  heizung_eco_mode:
    name: "Heizung Eco-Modus"
    icon: mdi:leaf
  heizung_winter_mode:
    name: "Heizung Winter-Modus"
    icon: mdi:snowflake

  # Special Modes
  movie_mode:
    name: "Filmzeit"
    icon: mdi:movie-open
  guest_mode:
    name: "Gästemodus"
    icon: mdi:account-group
  vacation_mode:
    name: "Urlaubsmodus"
    icon: mdi:airplane
  party_mode:
    name: "Party-Modus"
    icon: mdi:party-popper
  sleep_mode:
    name: "Schlafmodus"
    icon: mdi:sleep
  away_mode:
    name: "Abwesenheit"
    icon: mdi:home-export-outline
  gaming_mode:
    name: "Gaming-Modus"
    icon: mdi:controller
  stream_mode:
    name: "Streaming-Modus"
    icon: mdi:video

  # Automation Toggles
  auto_lights_enabled:
    name: "Automatische Beleuchtung"
    icon: mdi:lightbulb-auto
    initial: true
  auto_shutters_enabled:
    name: "Automatische Rollläden"
    icon: mdi:window-shutter-auto
    initial: true
  auto_heating_enabled:
    name: "Automatische Heizung"
    icon: mdi:thermostat-auto
    initial: true

  # Fire Effect (AppDaemon)
  fire_effect:
    name: "Fire Effect"
    icon: mdi:fire
    initial: off

# ============================================================================
# INPUT SELECT - Szenen & Modi
# ============================================================================
input_select:
  ambient_modus:
    name: "Ambient Modus"
    options:
      - "Aus"
      - "Warm Flicker"
      - "Velvet Rainbow"
      - "Entspannt"
      - "Fokus"
    initial: "Aus"
    icon: mdi:palette

  home_mode:
    name: "Zuhause Modus"
    options:
      - "Normal"
      - "Arbeit"
      - "Entspannen"
      - "Schlafen"
      - "Gäste"
      - "Urlaub"
    initial: "Normal"
    icon: mdi:home-assistant

# ============================================================================
# BINARY SENSOR - Templates
# ============================================================================
binary_sensor:
  - platform: template
    sensors:
      sommerbetrieb_ortsbasiert:
        friendly_name: "Sommerbetrieb (Außentemperatur)"
        value_template: "{{ states('sensor.openweathermap_temperature')|float(0) > 18 }}"
        icon_template: >-
          {% if states('sensor.openweathermap_temperature')|float(0) > 18 %}
            mdi:weather-sunny
          {% else %}
            mdi:snowflake
          {% endif %}

      jemand_zuhause:
        friendly_name: "Jemand Zuhause"
        value_template: >-
          {{ is_state('binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_1', 'on') or
             is_state('binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_2', 'on') or
             is_state('binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_3', 'on') or
             is_state('binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_4', 'on') or
             is_state('binary_sensor.presence_sensor_fp2_f9cf_presence_sensor_5', 'on') }}
        icon_template: >-
          {% if is_state('binary_sensor.jemand_zuhause', 'on') %}
            mdi:home-account
          {% else %}
            mdi:home-outline
          {% endif %}

      heizperiode:
        friendly_name: "Heizperiode aktiv"
        value_template: "{{ now().month in [1, 2, 3, 4, 10, 11, 12] }}"
        icon_template: mdi:radiator

      dunkel_draussen:
        friendly_name: "Dunkel draußen"
        value_template: >-
          {{ states('sensor.presence_sensor_fp2_f9cf_light_sensor_light_level')|float(100) < 30 or
             is_state('sun.sun', 'below_horizon') }}
        icon_template: mdi:weather-night

# ============================================================================
# SENSOR - Templates
# ============================================================================
sensor:
  - platform: template
    sensors:
      aktuelle_jahreszeit:
        friendly_name: "Aktuelle Jahreszeit"
        value_template: >-
          {% set month = now().month %}
          {% if month in [3, 4, 5] %}
            Frühling
          {% elif month in [6, 7, 8] %}
            Sommer
          {% elif month in [9, 10, 11] %}
            Herbst
          {% else %}
            Winter
          {% endif %}
        icon_template: >-
          {% set month = now().month %}
          {% if month in [3, 4, 5] %}
            mdi:flower
          {% elif month in [6, 7, 8] %}
            mdi:white-balance-sunny
          {% elif month in [9, 10, 11] %}
            mdi:leaf
          {% else %}
            mdi:snowflake
          {% endif %}

      rollladen_offset_minuten:
        friendly_name: "Rollladen Sonnenuntergang Offset"
        value_template: >-
          {% set month = now().month %}
          {% if month in [5, 6, 7, 8, 9] %}
            120
          {% elif month in [3, 4, 10] %}
            60
          {% else %}
            0
          {% endif %}
        unit_of_measurement: "min"

# ============================================================================
# NOTIFY - Groups
# ============================================================================
notify:
  - platform: group
    name: alle_geraete
    services:
      - service: mobile_app_redmi_note_12_pro_5g
