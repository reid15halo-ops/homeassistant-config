# ============================================================================
# AI AUTOMATIONS - Powered by n8n & LLMs
# ============================================================================

# 1. THE GROW BOT (Cannabis Manager)
# Checks environment every hour and sends data to n8n for analysis
- id: ai_grow_bot_check
  alias: "AI - Grow Bot Check (Hourly)"
  description: "Sends sensor data to n8n every hour for LLM analysis"
  trigger:
    - platform: time_pattern
      hours: "/1"
  action:
    - action: rest_command.n8n_grow_bot_check
      data:
        temperature: "{{ states('sensor.kiffzimmer_kiffzimmer_zelt_humidity_sensor_temperatur') }}"
        humidity: "{{ states('sensor.kiffzimmer_kiffzimmer_zelt_humidity_sensor_luftfeuchtigkeit') }}"
        stage: "Early Flowering" # You might want to make this an input_select later
        timestamp: "{{ now().isoformat() }}"
  mode: single

# 2. THE CLEANING TRACKER
# Calculates cost and generates report when cleaning mode ends
- id: ai_cleaning_tracker
  alias: "AI - Cleaning Tracker Report"
  description: "Triggers n8n workflow when cleaning mode is disabled"
  trigger:
    - platform: state
      entity_id: input_boolean.cleaning_mode
      from: "on"
      to: "off"
  action:
    - action: rest_command.n8n_cleaning_report
      data:
        start_time: "{{ trigger.from_state.last_changed.isoformat() }}"
        end_time: "{{ now().isoformat() }}"
        hourly_rate: 25
  mode: single

# 3. VOICE NOTIFICATIONS (Jarvis)
# Example trigger: Water Leak (Critical)
- id: ai_voice_alert_leak
  alias: "AI - Voice Alert (Water Leak)"
  trigger:
    - platform: state
      entity_id: binary_sensor.no_area_aqara_water_leak_sensor_wasserleck
      to: "on"
  action:
    - action: rest_command.n8n_voice_notify
      data:
        message: "Critical alert. Water leak detected in the apartment. Please check immediately."
        voice_id: "Rachel" # ElevenLabs Voice ID
  mode: single
